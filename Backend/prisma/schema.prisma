

generator client {
  provider = "prisma-client-js"
  output = "../node_modules/.prisma/client"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  REVIEW
  COMPLETED
}

enum NotificationType {
  TASK_ASSIGNED
  TASK_UPDATED
}




  model User {
    id          String   @id @default(uuid())
    email       String   @unique
    password    String?
    name        String
    githubId    String?  

    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt

    // Relations
    createdTasks   Task[] @relation("CreatedTasks")
    assignedTasks  Task[] @relation("AssignedTasks")
    notifications  Notification[]
    socketSessions SocketSession[]
    
    @@map("users")
  }




model Task {
  id            String       @id @default(uuid())
  title         String       @db.VarChar(100)
  description   String
  dueDate       DateTime
  priority      TaskPriority
  status        TaskStatus   @default(TODO)

  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  // Relations
  creatorId     String
  assignedToId  String

  creator       User @relation("CreatedTasks", fields: [creatorId], references: [id])
  assignedTo    User @relation("AssignedTasks", fields: [assignedToId], references: [id])

  notifications Notification[]

  @@index([status])
  @@index([priority])
  @@index([dueDate])
  @@map("tasks")
}




model Notification {
  id        String           @id @default(uuid())
  type      NotificationType
  message   String
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())

  // Relations
  userId    String
  taskId    String?

  user      User            @relation(fields: [userId], references: [id])
  task      Task?           @relation(fields: [taskId], references: [id])

  @@index([userId, isRead])
  @@index([createdAt])
  @@map("notifications")
}



model SocketSession {
  id        String   @id @default(uuid())
  userId    String
  socketId  String   @unique
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@map("socket_sessions")
}
